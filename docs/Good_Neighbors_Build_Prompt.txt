REVERSE-ENGINEERED BUILD PROMPT
================================
Last Updated: 2026-02-13

The following prompt could theoretically recreate the Good Neighbors project from scratch.

---

Build a full-stack peer-to-peer neighborhood sharing platform called "Good Neighbors" where neighbors can lend/borrow items and offer/request services.

TECH STACK
----------
- Frontend: React 18 + TypeScript + Vite, styled with Tailwind CSS (custom green brand palette). Use React Router v6 for routing, React Query (TanStack Query) for server state, React Hook Form + Zod for forms/validation, Axios for HTTP, sonner for toast notifications.
- Backend: Node.js + Express, PostgreSQL with Prisma ORM, JWT authentication (bcrypt for passwords, 24-hour token expiry), express-validator for request validation, express-rate-limit for auth endpoint rate limiting.
- Architecture: REST API on port 3000, frontend on port 5173 with Vite proxy (/api -> localhost:3000). Vite proxy returns 502 JSON response with helpful message when backend is unavailable (configure callback with [Proxy Error] console logging). JWT tokens stored in localStorage, attached via Axios request interceptor. 401 responses auto-redirect to login (skipped during intentional logout and on auth URLs). ApiError class preserves HTTP status, error code, and details from backend responses.


DATABASE SCHEMA
---------------
Design 11 models: User, Item, Request, Match, Transaction, Photo, Message, Rating, Notification, NotificationPreference. All IDs are UUIDs, all timestamps ISO 8601.

User: email (unique), passwordHash (bcrypt, 10 rounds), firstName, middleName (optional), lastName, phoneNumber (optional, unique), profilePhotoUrl, full address fields (address, address2, city, state, zipCode), latitude/longitude (Decimal), neighborhood, isVerified (default false), timestamps.

Item (listings): ownerId -> User, title, description. Implement a 3-tier hierarchical category system: listingType ('item'|'service'), categoryTier1/2/3 strings, plus isOther flag with customItemName. Keep a legacy "category" enum for backward compat. Include: condition enum (new/excellent/good/fair/poor), replacementValue, pricingType enum (free/hourly/daily/weekly/monthly), priceAmount, lateFeeAmount, protectionPreference enum (waiver_ok/insurance_required/deposit_required/let_me_decide), depositPercentage (0-100), isAvailable, availableFrom/Until dates (derived from availability rules for coarse DB filtering), photoUrls (JSON array), specialInstructions, and a details JSON field for category-specific specs, pricing tiers, and availability rules (e.g., {specs: {voltage: {value: 20}}, pricingTiers: {hourly: 5, daily: 25, weekly: 75}, availability: {mode: 'custom', dateRanges: [{from: '2026-03-01', until: '2026-03-15'}], recurringDays: [1,2,3,4,5]}, additionalNotes: "..."}). Availability rules: mode 'always' (default, no restrictions) or 'custom' (dateRanges: item only available during these windows; recurringDays: 0=Sun..6=Sat, only these weekdays; both combine when present). availableFrom/availableUntil auto-derived as min start / max end of date ranges for backward-compatible coarse DB filtering.

Request (borrower posts): requesterId -> User, same category tier system, title, description, details JSON (borrower specs with "flexibility" range and "requiredMatch" boolean per spec, plus budgetTiers object with per-unit budgets like {hourly: 10, daily: 45}), neededFrom/Until, maxBudget (legacy: max of all budget tiers), maxDistanceMiles (default 10), latitude/longitude, status enum (open/matched/accepted/cancelled/expired), expiresAt (optional, user-specified — defaults to null/no expiration).

Match: requestId -> Request, itemId -> Item, distanceMiles, matchScore (0-100 int), lenderNotified, lenderResponse enum (pending/accepted/declined/ignored), respondedAt. Unique constraint on (requestId, itemId). Match acceptance uses atomic updateMany with lenderResponse='pending' guard to prevent race conditions.

Transaction: requestId (optional) -> Request, itemId -> Item, borrowerId/lenderId -> User, status enum (requested/accepted/pickup_confirmed/active/return_initiated/return_confirmed/completed/disputed/cancelled), pickup/return times (scheduled + actual), fee fields (rentalFee, platformFee, taxRate Decimal(5,4), taxAmount, depositAmount, insuranceFee, totalCharged, lateFeeCharged — all monetary Decimal(10,2)), protectionType enum (waiver/insurance/deposit), paymentStatus enum, disputeReason, returnReminderSent, overdueNotificationSent.

Photo: transactionId -> Transaction, uploadedBy -> User, photoType enum (pickup_full_view/pickup_damage/pickup_serial/return_full_view/return_damage/return_serial), fileUrl, metadata JSON (GPS, timestamp, device).

Message: transactionId -> Transaction, senderId/recipientId -> User, messageText, photoUrl (optional), isRead (default false).

Rating: transactionId -> Transaction, raterId/ratedUserId -> User, role enum (lender/borrower), overallRating (1-5), optional dimension ratings (onTime, communication, condition, itemAsDescribed — each 1-5), reviewText, wouldTransactAgain boolean. Unique constraint on (transactionId, raterId). Both ratings hidden until both submit OR 7 days after return (anchored to actualReturnTime, falls back to updatedAt).

Notification: userId -> User, type string, title, message, data JSON, isRead, readAt. Support 19 types: match_created (lender), match_found (borrower), match_accepted, match_declined, transaction_requested/accepted/declined, pickup_confirmed, return_initiated, transaction_completed/disputed/active, message_received, rating_received, return_reminder, transaction_overdue, request_expired/expiring, approval_reminder.

NotificationPreference: userId + notificationType (unique pair), inAppEnabled (default true), emailEnabled (default false), smsEnabled (default false).


BACKEND API (55+ endpoints across 11 route modules)
----------------------------------------------------

Auth: POST /auth/register (validate email, password 8+ chars with uppercase + digit required, phone format, coords bounds, auto-geocode address via OpenStreetMap Nominatim), POST /auth/login, POST /auth/logout, PUT /auth/password (authenticated, validates current password, new password with same rules: 8+ chars with uppercase + digit). Rate limited: 10 requests/15min on login+register. Return {token, user}. Auth middleware: requireAuth (blocks unauthenticated), optionalAuth (attaches user if valid token, warns on invalid tokens via console.warn for debuggability, continues without user if no/bad token).

Users: GET /users/me (include stats: itemsListed, transactions, ratings with averages per role), PUT /users/me, GET /users/:id (public profile with stats + recent ratings + available items), GET /users/:id/ratings (paginated, filterable by role).

Items: POST /items (after creating item, run reverse matching against all open/matched requests — see BIDIRECTIONAL MATCHING below), GET /items (browse with filters: category tiers, condition, pricingType, price range, search text, location + radius in miles, availability dates, pagination + sorting — exclude requester's own items; date-aware filtering: when availableFrom/availableUntil provided, only exclude items with overlapping bookings for that date range; without dates, exclude all items with any active transaction as fallback; calculate distance when coords provided), GET /items/my-listings (paginated: returns `{items, pagination: {total, limit, offset}}`, default limit=50, max=100; include unavailable option), GET /items/:id (include owner rating stats, isCurrentlyBorrowed, activeTransaction, bookedPeriods array of future reserved date ranges for calendar display), PUT /items/:id (owner only), DELETE /items/:id (soft delete via isAvailable=false).

Requests: POST /requests (auto-run matching algorithm on creation, return request + matchesFound + top 5 matches, default location from user profile, expiresAt defaults to null — no auto-expiration), GET /requests/browse (public browsing of open requests with search, category, distance, date range filtering — compute averageRating from ratingsReceived relation, not as a direct DB field), GET /requests/my-requests (paginated, filterable by status), GET /requests/:id (include matches with items and owners), PUT /requests/:id (edit request — owner only, open/matched status only, partial updates for title/description/dates/budget/category/distance/specs, re-runs matching if dates or category changed), PUT /requests/:id/cancel, GET /requests/:id/matches.

Matches: GET /matches/incoming (matches for user's items, filterable by status — compute averageRating from ratingsReceived relation), PUT /matches/:id/respond ({response: "accepted"|"declined"} — on accept: check for date conflicts via hasDateConflict() first (revert match to 'pending' and return 409 if conflict), then update request status, auto-create transaction in 'accepted' status using request dates, item's protectionPreference, cheapest-tier fee calculation with sales tax, send transaction_accepted notification to borrower with transactionId, return {match, transaction, message}; on decline: notify requester with match_declined).

Transactions: POST /transactions (from matchId or itemId — for matches: only blocks if match is declined (not just non-accepted); auto-accepts pending matches when borrower confirms (updates match lenderResponse to 'accepted'); transaction still starts as 'requested' so lender must accept the transaction itself. Check for date conflicts first via hasDateConflict(), then check availability rules via isAvailableForDates() (returns 409 if item's custom schedule doesn't allow the requested dates), return 409 if overlapping booking exists — then calculate fees: rentalFee based on cheapest pricingTier x duration, platformFee = $1+3% split 50/50, sales tax at lender's state rate via getTaxRate(), insurance = 5% of replacementValue, deposit = depositPercentage% of replacementValue, totalCharged = rentalFee + borrowerPlatformFee + taxAmount + insuranceFee), GET /transactions/my-transactions (paginated, filterable by role/status; item select includes id, title, photoUrls, category, categoryTier2), GET /transactions/:id (full details with item, borrower, lender, photos, ratings), PUT /transactions/:id/status (validate state transitions — only lender can accept, etc.), PUT /transactions/:id/dispute.

Messages: POST /transactions/:id/messages, GET /transactions/:id/messages (paginated, auto-mark received as read), GET /messages/unread-count. Only borrower/lender can access.

Ratings: POST /transactions/:id/rating (only after completed/return_confirmed, one per rater per transaction, auto-complete transaction when both rate), GET /transactions/:id/ratings (visibility rules: only own rating visible until both submit or 7 days).

Notifications: GET /notifications (paginated, unreadOnly filter), GET /notifications/unread-count, PUT /notifications/:id/read, PUT /notifications/read-all, DELETE /notifications/:id, GET/PUT /notifications/preferences.

Insights: GET /insights/nearby-demand (open requests matching user's item categories within radius, two tiers: nearby + expanded), GET /insights/nearby-supply (available items matching user's request categories).

Categories: GET /categories/hierarchy (full tree), GET /categories/tier1, GET /categories/tier2, GET /categories/tier3 (cascading), GET /categories/search (fuzzy search with Levenshtein distance, max distance = max(2, length*0.3), return matchScore), POST /categories/validate, GET /categories/pricing (suggestions by tier+condition with low/suggested/high +/-30% ranges, defaults: hourly $5, daily $20, weekly $60, monthly $150), GET /categories/specs (dynamic spec field definitions per category: key, label, type [number/select/boolean/text/multi-select], unit, options, required, suggestRequired, flexibilityEnabled, defaultFlexibility, matchWeight, helperText).

GET /health for health check.

Automated Scheduler (runs hourly): Auto-activate transactions at pickup time, send 24hr return reminders, flag overdue transactions, expire old requests, send approval reminders for pending requests (12hrs+).


BIDIRECTIONAL MATCHING ALGORITHM
---------------------------------
Matching runs in TWO directions:

1. FORWARD (request created -> scan items): When a request is created, find all available items and score each 0-100. Return top matches to the requester and notify item owners.

2. REVERSE (item created -> scan requests): When an item is created, find all open/matched requests and score each 0-100. Create Match records for qualifying pairs and notify both parties: lender gets match_created, borrower gets match_found. Skip the item owner's own requests and any request-item pairs that already have a match (duplicate detection).

Both directions notify both parties with role-appropriate notification types:
- Lender: match_created → navigates to /matches (accept/decline)
- Borrower: match_found → navigates to /requests/:requestId (review matched items)

DATE CONFLICT FILTERING:
Before scoring, filter out items/requests with overlapping bookings. Forward matching (request→items): batch query via getItemIdsWithConflicts(allItemIds, neededFrom, neededUntil) — skips items in conflict set. Reverse matching (item→requests): per-request hasDateConflict() check — skips requests whose date range overlaps an existing booking on the item. Blocking statuses: requested, accepted, pickup_confirmed, active, return_initiated. Overlap formula: existingPickup < requestedReturn AND existingReturn > requestedPickup.

SCORING (0-100):
- Text relevance (45 pts max): extract keywords from titles/descriptions (remove stop words), score = (matching/total) x 100, scale to 45. Text spec fields (type: 'text') contribute 0 score without reducing the denominator (informational only, never penalize).
- Spec matching (15 pts max): compare borrower specs to lender specs per field type with weights. Numbers: flexibility-based decay. Booleans/selects: exact match. Multi-select: intersection ratio. Hard exclude if requiredMatch fails.
- Category match (8 pts): same tier hierarchy bonus
- Distance (12 pts): Haversine formula, closer = higher, cap at maxDistanceMiles
- Price fit (8 pts): Tier-aware — compare same pricing units when request.details.budgetTiers and item.pricingType overlap (e.g. daily vs daily). Budget >= price = full 8 pts. Budget < price = proportional (8 * budget/price). Free = 8 pts. Falls back to maxBudget comparison for old requests without budgetTiers. Cheaper items score higher.
- Condition (4 pts): new=4, excellent=3, good=2, fair=1, poor=0
- Owner rating (6 pts): average rating scaled
- Exact title match shortcut (85-97 range): starts at 85, +2 category, +0-8 price (uses estimateRentalCost to pick cheapest tier for full duration — returns null when pricing is invalid rather than cost:0, call sites handle null with neutral scoring; scores linearly: free/$0 = +8, at-budget = +0, cheaper = higher), +0-2 rating, -0-3 distance penalty.
- All scores rounded to 1 decimal place via Math.round(score * 10) / 10 for consistent precision.
- Hard filter: over-distance, over-budget (tier-aware when possible), hard-excluded specs, date conflicts with existing bookings, item availability rules (recurringDays + dateRanges via isAvailableForDates), low relevance (<10) unless same category


FEE CALCULATION (shared utility: src/utils/feeCalculation.js)
---------------
Cheapest-tier auto-selection: When an item has multiple pricing tiers in item.details.pricingTiers (e.g., {hourly: 10, daily: 40, weekly: 130, monthly: 320}), calculate the rental cost for each tier across the full duration and pick the cheapest. Example: 48-hour borrow with hourly=$10 and daily=$40 → picks daily (2×$40=$80) over hourly (48×$10=$480). Falls back to single pricingType/priceAmount when no tiers exist.

Rental fee: chosenRate x duration. Duration uses inclusive calendar day counting for daily/weekly/monthly tiers (Math.floor(diffMs / msPerDay) + 1, e.g., Feb 27–28 = 2 days). Hourly uses exact Math.ceil(diffMs / msPerHour). Weekly = ceil(inclusiveDays / 7), monthly = ceil(inclusiveDays / 30).
Platform fee: $1 + 3% of rental fee, split 50/50 (borrower pays half, lender = total - borrower to avoid penny discrepancies). All fee outputs rounded to 2 decimal places.
Sales tax: State-based rate via getTaxRate(ownerState) from src/utils/taxRates.js (50-state + DC lookup table). taxAmount = rentalFee × taxRate. Both taxRate and taxAmount stored on the transaction record.
Insurance fee: 5% of item.replacementValue (if protectionType = insurance), rounded to 2 decimals.
Deposit: item.replacementValue x (item.depositPercentage / 100) (if protectionType = deposit), rounded to 2 decimals. Deposit is a temporary refundable hold — NOT included in totalCharged.
Total charged to borrower: rentalFee + borrowerPlatformFee + taxAmount + insuranceFee. Deposit shown separately in UI.
Late fee: item.lateFeeAmount x daysLate (computed on return_confirmed/completed).
Net amount calculations: All display values use parseFloat(value.toFixed(2)) for proper 2-decimal rounding on deposit amounts, replacement values, and total estimates.
Returns: { rentalFee, platformFee, borrowerPlatformFee, lenderPlatformFee, taxRate, taxAmount, depositAmount, insuranceFee, totalCharged, chosenTier, chosenRate }.

BLACKOUT DATES & AVAILABILITY RULES (src/utils/dateConflict.js)
---------------
Prevents double-booking by checking date overlap before any transaction/match creation. Also enforces item availability rules.
Blocking statuses (dates reserved): requested, accepted, pickup_confirmed, active, return_initiated. Non-blocking: completed, cancelled, disputed.
Overlap formula: existingPickup < requestedReturn AND existingReturn > requestedPickup.
Exports:
- BLOCKING_STATUSES: array constant
- hasDateConflict(itemId, pickupTime, returnTime, excludeTransactionId?): returns {hasConflict, conflictingTransaction}
- getBookedPeriods(itemId): future booked periods for calendar display (used by GET /items/:id)
- getItemIdsWithConflicts(itemIds, pickupTime, returnTime): batch Set<itemId> for matching engine (avoids N+1)
- isAvailableForDates(item, pickupTime, returnTime): checks item.details.availability rules — returns false if: (a) dateRanges exist and request doesn't fall entirely within at least one range, or (b) recurringDays exist and any calendar day in the range falls on a disallowed weekday. Uses UTC methods (getUTCDay, setUTCHours, setUTCDate) for timezone safety since dates are stored as UTC midnight. Called by matching.js (both directions) and transactionController.js (on creation).

STATE TAX RATES (src/utils/taxRates.js)
---------------
Lookup table of US state-level sales tax rates (50 states + DC). getTaxRate(stateCode) returns decimal rate (e.g., CO → 0.029). Returns 0 for unknown states or null input. Used by both backend feeCalculation.js and frontend feeEstimate.ts (which has its own mirrored copy of the table).


ERROR HANDLING & SECURITY
-------------------------
asyncHandler wrapper on all route handlers, Prisma errors (P2002->409, P2025->404), JWT errors->401, production message hiding. CORS restricted to CORS_ORIGIN env var (default http://localhost:5173). Body size limit: 1MB max JSON. UUID param validation on all :id routes via express-validator. Pagination clamping across all controllers: limit clamped to 1-100, offset clamped to >=0. Critical mutations (createTransaction, submitRating, respondToMatch accept, cancelRequest) wrapped in prisma.$transaction() for atomicity. deleteItem checks for active transactions before soft-deleting (returns 409 if item has in-progress transactions). insightsController filters out declined requests from demand/supply results. Matching N+1 fix: owner ratings are batch-aggregated via Prisma groupBy instead of N+1 per-item includes. Database performance indexes on Transaction (status+returnTime, status+returnReminderSent, status+overdueNotificationSent), Notification (userId+type+createdAt), Rating (ratedUserId+role).


SEED DATA
---------
12 test users (alice/bob/carol/david/emma/frank/grace/hank/irene/jake/kate/leo @example.com, all password "password123") with realistic Fort Collins, CO locations, 16 sample items across categories, 3 sample requests with auto-generated matches, 1 completed transaction with ratings and messages.


FRONTEND (22 routes, React SPA)
--------------------------------

Route-based code splitting: All page components are lazy-loaded via `React.lazy()` with a `<Suspense>` fallback spinner for route-based code splitting.

Layout: Sticky header with logo (3 houses SVG, green-to-blue gradient), brand "Good Neighbors", nav links (Dashboard, Action Center [conditional — only when actions > 0, with red dot for urgent], Neighborhood, My Listings, My Requests, Transactions), NotificationBell with badge, profile dropdown. Mobile hamburger menu includes Action Center with red dot indicator. Footer. All pages wrapped in Layout + PageContainer (max-w-7xl, responsive padding). Header uses shared `useActionCenter()` hook (React Query cache dedup = no extra API calls) for action count and urgency tier.

Auth Context: Stores user + token in localStorage, provides login/register/logout/updateUser, restores on mount. Validates stored user with Zod schema (id, email, firstName, lastName) — clears invalid data. Login/register wrapped in try/catch with localStorage cleanup on failure. Logout sets isLoggingOut flag to prevent 401 redirect during intentional logout. Logout requires confirmation via ConfirmDialog (both desktop and mobile).

Notification Context: Polls every 30s, tracks unreadCount + newCount (since last viewed via localStorage timestamp), provides markAsRead/markAllAsRead/markAsViewed. Badge clearing delayed 3 seconds after viewing dropdown to allow user to read notifications. Click-outside listener only attached when dropdown is open for efficiency.

UI Component Library: Button (variants: default/primary/secondary/outline/ghost, sizes: sm/md/lg, loading spinner state) — used consistently across UI, replacing inline button elements in Matches (view details toggle), Neighborhood (type toggles, clear all), NotificationBell (Mark all as read); Input/Textarea/Select (with label + error display); Card (border, shadow, rounded, accepts style prop for animation delays); Modal (overlay + centered, backdrop close, entrance animation via CSS keyframes, ARIA: `role="dialog"`, `aria-modal`, `aria-labelledby`); Badge (variants: default/primary/success/warning/danger/info, sizes: sm/md; optional onClick prop renders as `<button>` instead of `<span>` with hover ring/brightness effects and cursor pointer for interactive status badges); Alert (success/error/warning/info with icons); EmptyState (icon + title + description + variant prop: default/info/success/warning); Spinner + LoadingPage; Loading Skeletons (layout-matched): ProfileSkeleton, ItemDetailSkeleton, TransactionDetailSkeleton, RequestDetailSkeleton — replace LoadingPage on respective pages for better UX; SummaryCard (variants: earned/spent/neutral — used for financial summary display); StarRating (SVG star display, sizes: sm/md/lg); ConfirmDialog (Modal wrapper for destructive/important actions, variants: danger/warning/default, used for logout confirmation); Tabs (ARIA: `role="tablist"` on container, `role="tab"` + `aria-selected` on each tab). NotificationBell dropdown has `role="menu"`, `aria-haspopup`, `aria-expanded`. Toast system: Toaster component from sonner mounted in App.tsx, mutations use toast.success/toast.error for user feedback.

CSS Animations (index.css): Define keyframes for fadeIn, slideUp, cardFadeIn, fadeInUp. Apply modal entrance animation. Implement staggered card fade-in on Neighborhood/Browse grids using Card component's style prop for animation delays.

Status Config Utility (src/utils/statusConfig.ts): Centralizes transaction status logic. Exports `getDaysUntil(date)` for day-distance calculation, `getTransactionUrgencyTier(transaction, isLender)` which returns 'red'|'yellow'|'green' based on role-aware tier rules (see Action Center), `getTransactionUrgencyDescription(transaction, isLender)` for time-aware action descriptions (e.g., "Pickup in 7 days — confirm handoff of Kayak to Bob Smith"), `urgencyTierToBadgeVariant(tier)` to map tiers to Badge component variants, and `getListingTransactionStatus(transactions, itemTitle)` which determines the display status for My Listings badges based on the highest-priority active transaction.

Date Helpers Utility (src/utils/dateHelpers.ts): `fmtShort(dateStr)` formats dates as "Feb 15", `formatDateContext(dateStr, prefix)` builds relative date strings like "needed in 3 days on Feb 15". Used by ActionCard and MatchActionCard components.

useActionCenter Hook (src/hooks/useActionCenter.ts): Shared hook encapsulating all action center logic — 3 React Query fetches (transactions, requests, incomingMatches with same cache keys for dedup), transaction splitting by role, urgency tier classification, recently completed green-tier items, requests-with-matches filtering, 7 mutation handlers (accept, decline, confirmPickup, startActive, initiateReturn, confirmReturn, complete), `handleQuickAction` dispatcher, decline confirmation state. Returns grouped actions, urgency counts, raw data for Dashboard's other sections, and mutation handlers. Used by Dashboard, Action Center page, and Header.

Fee Estimation Utility (src/utils/feeEstimate.ts): Shared client-side fee calculator that mirrors the backend logic. Takes item (pricingType, priceAmount, details.pricingTiers), request (neededFrom, neededUntil), and optional ownerState for tax calculation. When item has multiple pricing tiers, calculates cost for each and picks the cheapest. Duration uses inclusive calendar day counting for daily/weekly/monthly tiers (Math.floor(diffMs/msPerDay)+1); hourly uses exact Math.ceil. Includes mirrored state tax rate table (50 states + DC). Returns FeeEstimate object with: pricingType (chosen tier), pricePerUnit (chosen rate), durationUnits, unitLabel/unitLabelPlural, rentalFee, platformFee ($1+3%), borrowerPlatformFee (50% share), lenderPlatformFee (50% share), taxRate, taxAmount, borrowerTotal (rentalFee + borrowerPlatformFee + taxAmount), lenderEarnings (rentalFee - lenderPlatformFee). Returns null for free items or missing date ranges. Exported getTaxRate() function also used by ItemDetail Revenue Estimator.

Pages:

Landing: Hero with conditional greeting (authenticated vs not), "How it works" cards (4 steps), item category grid, service category grid, CTA section with dynamic buttons. Links to /register, /login, /neighborhood, /dashboard. Page fade-in animation on mount.

Login: Email + password form (React Hook Form + Zod), error handling + loading state, redirects to original location on success or /dashboard, link to /register.

Register: Multi-field form: firstName, middleName, lastName, email, phoneNumber, password, confirmPassword. Address fields: street, apt/suite, city, state, zipCode, neighborhood. Optional GPS location detection via browser geolocation API. Password match validation (Zod refine). Phone length validation (min 10 chars).

Neighborhood: Unified Supply/Demand toggle page replacing old Browse and NearbyDemand. Supply tab: hierarchical category filtering (listingType -> tier1 -> tier2 -> tier3), search box, condition filter, pricing type filter, distance-based filtering (5/10/25/50/100 miles), GPS or profile-based location, paginated item grid with staggered card fade-in animation. Active filters are shown as dismissible chip breadcrumbs above results with individual remove buttons and a "Clear all" action (using consistent Button components). Demand tab: browse open requests with requester info (first name + last initial for privacy), needed dates, budget, category, distance, match count. Request cards styled with category-to-color gradient mapping (8 categories: tools→emerald, outdoor→blue, party→purple, lawn→green, vehicles→orange, workspace→indigo, specialized→teal, services→pink). /browse redirects to /neighborhood. Public access.

Item Detail: Photo display, title, description, category, condition, specs. Owner info: name, rating (clickable — links to owner's profile/reviews), verified badge. Rich availability display in Details section: reads item.details.availability — shows "Always Available" (green) for default, formatted recurring days with "Weekdays"/"Weekends" shorthand + date ranges for custom mode, legacy availableFrom/availableUntil fallback with UTC timezone. Pricing NOT shown in Details section (lives only in Revenue Estimator for owners / booking flow for borrowers). Booked periods card (owner-only): blue "Upcoming Bookings" card listing reserved date ranges with status from item.bookedPeriods. Booked dates card (non-owners only): red "Unavailable Dates" card listing existing bookings from item.bookedPeriods API response. Revenue Estimator (owner-only, paid items): shows each pricing tier sorted hourly > daily > weekly > monthly with per-unit earnings breakdown (platform commission as 50% share, estimated sales tax at owner's state rate, net earnings per unit, replacement value displayed with 2-decimal rounding via parseFloat(toFixed(2))). "Borrow" modal for non-owners: pickup time, return time, protection type selector, fee preview section showing line items (rental fee, platform fee as borrower's 50% share, sales tax at state rate, insurance fee if applicable, deposit as separate refundable hold), client-side date conflict validation (checks selected dates against item.bookedPeriods, shows amber warning + disables submit if overlap detected), backend 409 errors displayed via existing error alert. Links to /transactions after request creation. Use ItemDetailSkeleton while loading.

Create Item: Multi-step form: (1) CategorySelector (item/service -> 3-tier picker + "Other" custom name), (2) Title + description, (3) Dynamic SpecsForm in lender mode (simple value inputs per spec field), (4) Condition + replacement value, (5) PricingSuggestions (auto-populate from API based on category+condition, display with float-safe formatting via Number.isInteger() — whole numbers show without decimals), (6) Pricing type + amount, (7) Protection preference (waiver_ok/deposit_required/insurance_required/let_me_decide), (8) Rich availability scheduling: radio toggle (Always Available / Custom Schedule), custom mode shows: multiple date range inputs with add/remove, weekday checkboxes (Mon-Sun), helper text explaining combinations. On submit: packages into details.availability = {mode, dateRanges, recurringDays}, derives availableFrom/availableUntil from date ranges for backward compat. (9) Photo URLs (multiple, manual entry), (10) Special instructions. React Query mutation on submit. On success, backend auto-reverse-matches against open requests. Form validation: tier-specific category validation messages (e.g., "Select a subcategory" varies by tier depth), required spec fields validated before submission, auto-scroll to first validation error ([role="alert"] or .text-red-600 element) via scrollToError() callback. Draft save indicator: useDraftForm hook tracks lastSaved timestamp, displayed in form header.

Edit Item: Same form as CreateItem, pre-fills with existing item data including availability rules (reads item.details.availability to populate radio, date ranges, and day checkboxes), PUT request, ownership check.

My Listings: Table/grid of user's items with thumbnail, title, category, condition, pricing (displayed with float-safe formatting via Number.isInteger() — whole numbers without decimals), status badge driven by `getListingTransactionStatus()` from statusConfig.ts — shows accurate status per highest-priority active transaction: `requested` -> "Pending", `accepted` -> "Accepted", `pickup_confirmed`/`active` -> "With {borrowerName}", `return_initiated`/`return_confirmed` -> "Returning", otherwise "Available" or "Unavailable". Status badges are clickable: active transaction badges navigate to /transactions/:id, "Available"/"Unavailable" navigate to /items/:id. Shows "+N upcoming bookings" count when additional non-terminal transactions exist on the same item. Earnings from completed borrows, edit/delete actions. Rate sort: hourly > daily > weekly > monthly. Empty state. Link to /items/new.

Create Request: Multi-step form: (1) CategorySelector, (2) Dynamic SpecsForm in borrower mode (includes flexibility +/- range sliders for numeric specs, "required for match" checkboxes), (3) Date needed range, (4) Per-tier budget inputs (hourly/daily/weekly/monthly, stored as budgetTiers in details JSON + maxBudget as max of all for legacy compat), (5) Max distance (5/10/25/50 miles), (6) Location (auto-uses profile or GPS). Location is validated at submission time — if unavailable, shows a toast error instead of blocking the form. On submit: creates request + triggers backend matching. Form validation: tier-specific category validation messages, required spec fields validated before submission, auto-scroll to first validation error ([role="alert"] or .text-red-600 element) via scrollToError() callback. Draft save indicator: useDraftForm hook tracks lastSaved timestamp, displayed in form header. Redirects to /requests/:id with matches.

Edit Request: Same form as CreateRequest, pre-populated with existing request data. Owner-only, restricted to open/matched status. Fetches request by ID, verifies ownership. On submit: calls PUT /requests/:id with partial updates, re-runs matching if dates/category changed. On success: invalidates queries, toast, navigates to /requests/:id.

Request Detail (borrower view): Request details + ranked matches. Each match card shows: item photo, title, owner name, owner rating (clickable — links to owner's profile), match score badge (e.g., "91% match"), condition, price. Financial estimate section per card: "Estimated Cost" with rate x duration calculation using cheapest pricing tier (e.g., "$40.00/day x 2 days = $80.00" instead of "$10.00/hr x 48 hours = $480.00"), platform fee ("+$1.70" — borrower's 50% share), estimated sales tax at owner's state rate ("+$2.32 est. tax (~2.9%)"), estimated total ("$84.02"), note about protection fees at checkout, over-budget warning if total exceeds their budget tier. Borrower does NOT see lender's post-commission earnings. "Confirm & Borrow" button on match cards (for pending and accepted matches without existing transactions): pre-fills pickup/return dates from request dates (9AM pickup, 5PM return), pre-selects lender's protection preference (maps waiver_ok→waiver, deposit_required→deposit, insurance_required→insurance, let_me_decide→waiver), opens confirm modal with item summary, editable dates and protection, live fee estimate, deposit callout ("$X security deposit held at checkout, refunded after return"), insurance as fee line item. "View Transaction" for matches with existing transactions. "Not available" label for declined matches. "View Item" as small text link. Edit button for owner of open/matched requests. Cancel request button for owner. Use RequestDetailSkeleton while loading.

My Requests: List grouped by status, match counts, distance to nearest match, actions (View/Edit/Close/Cancel). Status badges are clickable: "In Progress"/"Fulfilled"/"Completed" navigate to the associated transaction, "Has Matches"/"Match Accepted" navigate to /requests/:id (matches section), "Searching"/"Unfulfilled"/"Cancelled" navigate to /requests/:id. Edit button on open/matched request cards links to /requests/:id/edit. Empty state.

Matches (lender view): Incoming matches for user's items. Pending section: borrower name, item title, request summary, match score badge, distance, date needed, Accept/Decline buttons. On Accept: mutation calls acceptMatch which returns {match, transaction, message}, then navigates directly to /transactions/:transactionId so lender sees the auto-created transaction immediately. Expanded details show: match score with explanation, date range, requester rating (clickable), profile link. "View details" toggle uses consistent Button component. Financial breakdown section: "Estimated Earnings" using cheapest pricing tier (e.g., "$40.00/day x 2 days = $80.00" instead of "$10.00/hr x 48 hours"), platform commission deducted (lender's 50% share), estimated net earnings. Falls back to tier-aware rate comparison (your rate vs their budget with green/amber indicator) if dates missing, or raw maxBudget for old data. "Free — no fees apply" for free items. Previous section: faded, shows response status. Empty state.

Transactions: All user's transactions (as lender and borrower). Color-coded Lending (green) / Borrowing (blue) filter tabs at top. Active transactions grouped by role with Lending and Borrowing sub-sections. Sort dropdown with visible "Sort by" label (date, status, amount). Each card: item photo + title, other party, status badge (color-coded), dates, fees, left border accent (green for lending, blue for borrowing). Financial summary: 2-column grid with Earned and Spent SummaryCards (no savings estimate). Empty state.

Transaction Detail: Full transaction view with item details, borrower/lender info, status timeline with role-appropriate action buttons (Lender: Accept -> Confirm Pickup -> Confirm Return -> Complete; Borrower: Ready for Pickup -> Initiate Return -> Rate). Role-specific fee breakdown — Borrower sees: rental fee + platform fee (50% share) + sales tax (at state rate) + insurance fee + late fees = total. All amounts displayed with 2-decimal rounding via parseFloat(toFixed(2)), especially net amounts, deposit amounts, and replacement values. Security deposit shown separately below total as blue info callout: active transactions show "Temporary hold — refunded after return"; completed/cancelled show "Refunded" with strikethrough on amount. Lender sees: rental fee - platform fee (50% share) + late fees collected = net earnings. Shows item late fee rate if configured. Per-transaction messaging section (message list + text input). Rating section if completed (5-star overall + optional dimension ratings + text comment + "would transact again"). Dispute button for active/return phases. Rating displays link to user profiles. Use TransactionDetailSkeleton while loading.

Dashboard: **Compact Action Center summary** (ActionCenterSummary component) — urgency-tinted card (border + background color matches highest tier: red/yellow/green). Shows actionable text summaries per role: "Lending — 2 need response, 1 return to confirm" / "Borrowing — 2 with matches, 1 due soon". Leading dot pulses when red-tier actions exist. Per-row colored dot reflects row's highest urgency. Rows are clickable links to `/action-center?tab=lending` or `?tab=borrowing`. "View all N" links to `/action-center` (All tab). Summary text generated from transaction statuses: lending maps requested→"need response", accepted→"pickup pending", return_initiated→"return to confirm", return_confirmed→"to finalize", completed→"to review", active→"due back soon"; borrowing uses `getDaysUntil()` to differentiate overdue (days<0) from "due soon", plus match requests→"with matches". Uses `useActionCenter()` hook (shared React Query cache = no extra API calls). Pending matches banner shown below. Financial summary: 2-column grid with Earned and Spent SummaryCards. Quick actions (List an Item, Post a Request). Activity overview: My Listings card (count, available, currently lent), My Requests card (active count, matches to review, fulfilled total, nearby supply insight linking to /neighborhood when active requests exist), Rating card (stars + count, clickable to /my-ratings). Active Transactions section split by Lending/Borrowing with role-aware status badges and return time warnings.

Action Center (/action-center): **Full dedicated page** with three tabs: All (default), Lending, Borrowing & Requests. All tab shows both Lending and Borrowing sections with subheadings. Tab selection from URL param `?tab=all|lending|borrowing`. Lending tab: ActionCards for all lending transactions sorted by urgency tier (red/yellow/green). Borrowing tab: MatchActionCards (requests with matches) + ActionCards (borrowing transactions). All inline quick-action buttons functional (accept/decline, confirm pickup, start active, initiate return, confirm return, complete, rate). ConfirmDialog for decline. Pending matches banner at top. Back link to Dashboard. Loading skeleton. Empty "All caught up!" state. ActionCard and MatchActionCard are shared components (src/components/ActionCard.tsx) also used by Dashboard's useActionCenter hook. Tier assignment via `getTransactionUrgencyTier()`: RED = lender with requested/return_initiated/return_confirmed, lender accepted <=2 days to pickup, borrower active <=2 days to return; YELLOW = lender accepted >2 days, borrower active 3-7 days, pickup_confirmed, borrower accepted <=7 days, lender active <=7 days; GREEN = completed <=14 days (capped at 3). Tier-colored card styling: red `border-red-200 bg-red-50/50`, yellow `border-yellow-200 bg-yellow-50/50`, green `border-green-200 bg-green-50/50`.

Profile: Editable user fields (name, address — email and phone read-only). Edit mode toggle with save/cancel and validation. Collapsible "Change Password" section with current password, new password, and confirm password fields (same validation rules: 8+ chars, uppercase, digit). Rating summary (clickable — links to /my-ratings). Use ProfileSkeleton while loading.

Public Profile: Other user's name, photo, neighborhood, verification status. Stats (total transactions, ratings, average). Recent ratings. Available items grid.

Notifications: Infinite scroll list. Filter tabs: All/Unread. "Mark all as read" button (using consistent Button component). Notification cards with icon per type, message, timestamp. Click auto-navigates based on notification type + data. Pagination with "Load more".

Notification Settings: Table of notification types with per-channel toggles (In-App/Email/SMS).

My Ratings: Rating summary (average to 1 decimal + total count). List of all received ratings with rater info, 5-star display, date, comment, link to transaction. Use custom skeleton while loading (matches MyRatings page structure).

CategorySelector component: Toggle item/service -> tier1 dropdown (loads from API) -> tier2 -> tier3 -> "Other" shows custom name input. Includes fuzzy search mode with debounced query, max 15 results displayed with "X more results" indicator when truncated. Two modes: 'listing' ("What are you listing?") and 'requesting' ("What are you looking for?").

SpecsForm component: Fetches spec definitions from GET /categories/specs. Lender mode: simple value inputs per spec field. Borrower mode: adds flexibility +/- range for numbers and "required for match" checkbox. Dynamic per category — no specs for "Other".

ProtectedRoute: Checks auth context, redirects to /login preserving location state for post-login redirect, shows spinner while loading. Wraps children in ErrorBoundary with key={location.pathname} for page-level error handling.

Axios client: baseURL from VITE_API_URL or '/api', request interceptor adds Bearer token, response interceptor throws ApiError (extends Error with status, code, details fields) and handles 401 (clear token, redirect — skips during intentional logout and on auth URLs). setLoggingOut() export used by AuthContext to prevent redirect during logout. All 8 API files use consistent `import apiClient from './client'` (default import). Shared PaginationMeta type (total, limit, offset) in types/index.ts used by PaginatedResponse<T> and all paginated API responses.

Date display: All date-only fields (neededFrom, neededUntil, availableFrom, availableUntil) are stored as UTC midnight in PostgreSQL. Frontend displays them with timeZone: 'UTC' in toLocaleDateString() options to prevent off-by-one display in US timezones. A formatDateOnly() utility in src/utils/dateFormat.ts enforces this. Full datetime fields (createdAt, pickupTime with time component) use local timezone as expected.

React Query config: 5-minute staleTime, adaptive retry (never retries 4xx client errors, up to 2 retries for 5xx/network errors with exponential backoff: min(1000 * 2^attempt, 10000)). Cache invalidation after mutations on related query keys.

Custom Hooks: useDraftForm(formKey, formData) — tracks draft form state in localStorage, returns lastSaved timestamp for display on CreateItem and CreateRequest forms.

Header Component: Active nav state highlighting — desktop links use text-primary-600 when active, mobile nav items get bg-primary-50 text-primary-700 when active. Uses useLocation() + isActive() helper to determine active routes.

Tailwind config: Custom green primary palette (primary-50 through primary-900, primary-600 = #16a34a). Extends with blue, emerald, orange, purple, red. Custom component layer classes for buttons (.btn, .btn-primary), inputs (.input), and labels (.label) in index.css. Animation keyframes: fadeIn, slideUp, cardFadeIn, fadeInUp for micro-animations throughout the UI. Focus-visible keyboard navigation: `:focus:not(:focus-visible)` removes outlines on mouse clicks; `:focus-visible` shows primary ring on keyboard Tab navigation; all Button and CSS component classes use `focus-visible:` instead of `focus:` (WCAG AA compliant).
